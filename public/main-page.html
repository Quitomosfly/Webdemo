<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Schedule</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        td, th {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }
        .selected {
            background-color: #4CAF50;
            color: white;
        }
    </style>
</head>
<body>
    <h1>Event Schedule</h1>
    <h2 id="eventName"></h2>
    <p><strong>Schedule Type:</strong> <span id="scheduleType"></span></p>
    <p><strong>Time Range:</strong> <span id="timeRange"></span></p>
    <p><strong>Selected Dates:</strong> <span id="selectedDates"></span></p>
    <p><strong>Selected Days:</strong> <span id="selectedDays"></span></p>
    
    <h3>Share this link:</h3>
    <input type="text" id="shareLink" readonly>
    <button onclick="copyLink()">Copy Link</button>

    <script>
        async function fetchEventData() {
            const params = new URLSearchParams(window.location.search);
            const eventId = params.get("id");

            if (!eventId) {
                document.body.innerHTML = "<h2>Invalid Event ID</h2>";
                return;
            }

            try {
                const response = await fetch(`/events/${eventId}`);

                // Check if response is HTML (server error)
                const contentType = response.headers.get("content-type");
                if (!response.ok || !contentType.includes("application/json")) {
                    const errorText = await response.text(); // Read error as text
                    throw new Error(`Server Error: ${errorText}`);
                }

                const event = await response.json();

                document.getElementById("eventName").innerText = event.eventName;
                document.getElementById("scheduleType").innerText = event.scheduleType;
                document.getElementById("timeRange").innerText = event.timeRange;
                document.getElementById("selectedDates").innerText = event.selectedDates.join(", ") || "N/A";
                document.getElementById("selectedDays").innerText = event.selectedDays.join(", ") || "N/A";

                // Generate shareable URL
                const shareURL = `${window.location.origin}/main-page.html?id=${eventId}`;
                document.getElementById("shareLink").value = shareURL;
            } catch (error) {
                document.body.innerHTML = `<h2>Error loading event: ${error.message}</h2>`;
            }
        }

        function copyLink() {
            const shareLink = document.getElementById("shareLink");
            shareLink.select();
            document.execCommand("copy");
            alert("Link copied to clipboard!");
        }

        fetchEventData();
    </script>
</body>
</html>
